<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>üèÅ Winners ‚Äî Live</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{background:#000;color:#39ff14;font-family:system-ui,Arial,sans-serif;margin:0;padding:16px}
    .card{border:1px solid #0f2510;border-radius:12px;background:#111;margin:8px 0;overflow:hidden}
    .hero{height:160px}
    .red{background:#a60000}.blue{background:#0058a6}
    .meta{padding:10px 12px;display:flex;justify-content:space-between}
    .empty{opacity:.6;padding:20px;text-align:center;border:1px dashed #0f2510;border-radius:12px}
  </style>
</head>
<body>
  <h1>üèÅ Winners</h1>
  <div id="content"></div>

  <script>
    const SUPABASE_URL = "https://tuqvpcevrhciursxrgav.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1cXZwY2V2cmhjaXVyc3hyZ2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1MDA0NDQsImV4cCI6MjA3MjA3NjQ0NH0.JbIWJmioBNB_hN9nrLXX83u4OazV49UokvTjNB6xa_Y";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const content = document.getElementById("content");
    function render(list){
      content.innerHTML="";
      if(!list.length){ content.innerHTML='<div class="empty">No winners yet.</div>'; return; }
      list.forEach(r=>{
        const el=document.createElement("div"); el.className="card";
        const hero=document.createElement("div"); hero.className="hero "+r.color;
        const meta=document.createElement("div"); meta.className="meta";
        meta.innerHTML=`<b>${r.name}</b> ‚Äî ${r.color.toUpperCase()} <span>${new Date(r.decided_at).toLocaleTimeString()}</span>`;
        el.append(hero,meta); content.append(el);
      });
    }

    async function loadInitial(){
      let {data,error} = await supabase.from("winners").select("*").order("decided_at",{ascending:false}).limit(50);
      if(error){ console.error(error); return []; }
      return data;
    }

    (async ()=>{
      let rows=await loadInitial(); render(rows);
      supabase.channel("winners-stream")
        .on("postgres_changes",{event:"INSERT",schema:"public",table:"winners"},payload=>{
          rows.unshift(payload.new); render(rows);
        })
        .subscribe();
    })();
  </script>
</body>
</html>