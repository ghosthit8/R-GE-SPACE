<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Rage Space ‚Äî Matchup</title>

  <!-- no-cache hints for GH Pages -->
  <meta http-equiv="Cache-Control" content="no-store, max-age=0, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Preconnect + Supabase client -->
  <link rel="preconnect" href="https://tuqvpcevrhciursxrgav.supabase.co">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="./css/matchup.css"/>

  <!-- Minimal safe fallback to avoid a flash while CSS loads -->
  <style>
    body{background:#000;color:#39ff14;margin:0;font-family:system-ui,Arial,Helvetica,sans-serif}
    .wrap{max-width:980px;margin:16px auto 64px;padding:0 16px}
    #bootLoader{position:fixed;inset:0;display:grid;place-items:center;background:#000}
    .boot-bar{width:76vw;max-width:640px;height:8px;background:#111;border:1px solid #0a0;box-shadow:0 0 10px #0a0 inset}
    .boot-fill{height:100%;width:0;background:#0f0;transition:width .1s linear}
    .boot-title{color:#0f0;margin-bottom:8px}
    .boot-sub{color:#8f8;margin-top:8px}
  </style>
</head>
<body>

  <!-- CYBERPUNK LOADING OVERLAY -->
  <div id="bootLoader" aria-live="polite">
    <div class="boot-title">Rage Space ‚Äî syncing‚Ä¶</div>
    <div class="boot-bar"><div class="boot-fill" id="bootFill"></div></div>
    <div class="boot-sub" id="bootMsg">initializing</div>
  </div>

  <div class="wrap">
    <div class="scorebar">
      <div class="tiny">
        <strong>Decision in</strong>
        <span id="clock" class="clock">Sync‚Ä¶</span>
        <span id="state" class="clock">‚Äî</span>
        <span id="phaseKey" class="clock">phase: ‚Äî</span>
        <span id="loginBadge" class="badge">checking auth‚Ä¶</span>
      </div>
      <div class="row">
        <button id="btnPause" class="btn">‚è∏Ô∏è Pause</button>
        <a class="btn" href="./winners.html">üèÅ Winners</a>
      </div>
    </div>

    <!-- Current Match tiles -->
    <div class="tile" id="tileA" data-color="red">
      <div class="artbox">
        <img id="imgA" class="art" alt="Entry Left"/>
        <button class="fsbtn" data-target="imgA" title="View fullscreen">‚õ∂</button>
      </div>
      <div class="caption" id="countA">0 votes</div>
      <div class="meta">
        <span id="labelA">Left</span>
        <button class="btn primary" id="voteA">Vote This</button>
      </div>
    </div>

    <div class="tile" id="tileB" data-color="blue">
      <div class="artbox">
        <img id="imgB" class="art" alt="Entry Right"/>
        <button class="fsbtn" data-target="imgB" title="View fullscreen">‚õ∂</button>
      </div>
      <div class="caption" id="countB">0 votes</div>
      <div class="meta">
        <span id="labelB">Right</span>
        <button class="btn primary" id="voteB">Vote This</button>
      </div>
    </div>

    <div class="row">
      <button class="btn" id="submitBtn" disabled>‚úÖ Submit Vote</button>
    </div>

    <!-- Bracket list -->
    <section class="bracket" id="bracket">
      <div class="bracket-head">
        <div class="bracket-title">Bracket</div>
        <label class="switch">
          <input id="showDone" type="checkbox" />
          <span>Show finished rounds</span>
        </label>
      </div>
      <div id="brows"></div>
    </section>
  </div>

  <div id="toast" class="toast"></div>

  <!-- FINAL OVERLAY -->
  <div id="overlay">
    <canvas id="confetti"></canvas>
    <div class="overlay-bg">
      <div class="scanlines-behind"></div>
      <div class="vignette"></div>
      <div class="overlay-stage">
        <div class="art-wrap">
          <img id="overlayArtImg" alt="Winning Art"/>
          <div class="scanline-frame">
            <div class="band top"></div>
            <div class="band bottom"></div>
            <div class="band left"></div>
            <div class="band right"></div>
          </div>
        </div>
      </div>
    </div>
    <button id="overlayClose" class="btn">‚úï</button>
    <div class="overlay-card" id="overlayCard">
      <h1 id="overlayTitle">CHAMPION</h1>
      <div class="sub typewriter-text" id="overlaySubtitle"></div>
      <div class="motto typewriter-text" id="overlayMotto"></div>
    </div>
  </div>

  <!-- Fullscreen overlay -->
  <div id="fsOverlay">
    <button id="fsClose">‚úï</button>
    <img id="fsImage" alt="Fullscreen Art"/>
  </div>

  <!-- Main app config first (matches your project) -->
  <script type="module">
    export const SUPABASE_URL = "https://tuqvpcevrhciursxrgav.supabase.co";
    export const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1cXZwY2V2cmhjaXVyc3hyZ2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1MDA0NDQsImV4cCI6MjA3MjA3NjQ0NH0.JbIWJmioBNB_hN9nrLXX83u4OazV49UokvTjNB6xa_Y";
    export const EDGE_URL = `${SUPABASE_URL}/functions/v1/global-timer`;
  </script>

  <!-- Version tag to bust module caches -->
  <script>
    window.__APP_VER__ = "2025-10-16-04";
  </script>

  <!-- App entrypoint (order matters). Add ?v=VER for cache-bust -->
  <script type="module" src="./js/core.js?v=2025-10-16-04"></script>
  <script type="module" src="./js/services.js?v=2025-10-16-04"></script>
  <script type="module" src="./js/ui.js?v=2025-10-16-04"></script>
  <script type="module" src="./js/features/bracket.js?v=2025-10-16-04"></script>
  <script type="module" src="./js/features/overlay.js?v=2025-10-16-04"></script>
  <script type="module" src="./js/main.js?v=2025-10-16-04"></script>

  <!-- Optional: unregister any old service workers (harmless if none) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.getRegistrations?.().then((regs) => {
        for (const r of regs) r.unregister();
      }).catch(() => {});
    }
  </script>

  <!-- Mobile Debugger (inline) -->
  <script>
// ========== üîß Simple Mobile Debugger ==========
(function () {
  const dbg = document.createElement('div');
  dbg.id = 'debugPanel';
  dbg.style.cssText = `
    position: fixed; bottom: 0; right: 0;
    background: rgba(0,0,0,0.9); color: #0f0; font-family: monospace;
    font-size: 11px; line-height: 1.3em; max-height: 40%; width: 100%;
    overflow-y: auto; z-index: 99999; padding: 4px; display: none;
  `;

  const toggle = document.createElement('button');
  toggle.textContent = 'üêõ Debug';
  toggle.style.cssText = `
    position: fixed; bottom: 5px; right: 5px;
    z-index: 100000; font-size: 12px; background:#000; color:#0f0;
    border: 1px solid #0f0; padding: 3px 6px; border-radius: 4px;
  `;
  toggle.onclick = () => dbg.style.display = dbg.style.display === 'none' ? 'block' : 'none';

  const controls = document.createElement('div');
  controls.innerHTML = `<button id="dbgCopy">Copy</button><button id="dbgClear">Clear</button>`;
  controls.style.cssText = 'position: sticky; top: 0; background: #111; padding: 2px;';
  controls.querySelectorAll('button').forEach(b => {
    b.style.cssText = 'background:#000; color:#0f0; border:1px solid #0f0; margin-right:4px;';
  });

  const logContainer = document.createElement('div');
  dbg.appendChild(controls);
  dbg.appendChild(logContainer);
  document.body.appendChild(dbg);
  document.body.appendChild(toggle);

  function addLine(type, msg) {
    const line = document.createElement('div');
    line.textContent = `[${new Date().toLocaleTimeString()}] ${type}: ${msg}`;
    logContainer.appendChild(line);
    dbg.scrollTop = dbg.scrollHeight;
  }

  const origLog = console.log;
  const origErr = console.error;
  console.log = (...args) => { origLog(...args); addLine('LOG', args.join(' ')); };
  console.error = (...args) => { origErr(...args); addLine('ERR', args.join(' ')); };

  window.addEventListener('error', (e) => {
    addLine('ERR', e.message + (e.filename ? ` @ ${e.filename}:${e.lineno}` : ''));
  });
  window.addEventListener('unhandledrejection', (e) => {
    addLine('PROMISE', (e.reason && e.reason.message) || JSON.stringify(e.reason));
  });

  document.getElementById('dbgCopy').onclick = () => {
    navigator.clipboard.writeText(logContainer.innerText).then(() => {
      addLine('INFO', 'Copied debug log');
    });
  };
  document.getElementById('dbgClear').onclick = () => {
    logContainer.innerHTML = '';
    addLine('INFO', 'Cleared');
  };

  window.debugLog = (msg) => addLine('MANUAL', msg);
})();
  </script>
</body>
</html>