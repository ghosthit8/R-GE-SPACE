<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rage Space ‚Äî Home</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --green:#39ff14; --red:#ff0033; --bg:#000; --ink:#e5ffe5; --muted:#8aff8a;
      --title-scale-y:1.28; --title-stroke:.8px; --title-letterspace:.28rem;
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      overflow-x:hidden;
      background:
        repeating-linear-gradient(
          to bottom,
          #000 0px,
          #000 2px,
          rgba(255,255,255,0.03) 3px
        );
      color:var(--green);
      font-family:ui-sans-serif,system-ui,Arial,Helvetica,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      position:relative;
    }

    .wrap{ max-width:980px; margin:0 auto; padding:0 16px; position:relative; z-index:2; }
    .hero{ min-height:100dvh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding-top:16vh; }

    .title{
      margin:0 auto 30px; font-weight:600; font-size:clamp(44px,12.5vw,150px);
      letter-spacing:var(--title-letterspace); text-transform:uppercase; line-height:.9;
      transform:scaleY(var(--title-scale-y)); transform-origin:center; color:var(--green);
      -webkit-text-stroke:var(--title-stroke) var(--green);
      text-shadow:0 0 24px var(--red), 0 0 6px rgba(57,255,20,.85);
      text-align:center; white-space:nowrap; user-select:none;
      animation:titleGlow 3.75s ease-in-out infinite alternate;
    }
    @keyframes titleGlow{
      0%{ text-shadow:0 0 18px rgba(255,0,51,.5), 0 0 5px rgba(57,255,20,.75); }
      100%{ text-shadow:0 0 28px rgba(255,0,51,.75), 0 0 10px rgba(57,255,20,1); }
    }

    .tagline{
      color:var(--green); font-size:clamp(16px,2.8vw,24px); line-height:1.55; text-align:center;
      max-width:780px; margin:20px auto 0; text-shadow:0 0 10px rgba(57,255,20,.45), 0 0 6px rgba(255,0,51,.6);
    }

    .enter-msg{
      margin: 100px auto 0; font-size: 16px; color: var(--ink); text-align: center;
      opacity: .95; min-height: 1.6em;
    }
    @keyframes hardFlicker {
      0%, 5%, 7%, 9%, 11%, 100% { opacity:1; text-shadow:0 0 10px var(--green), 0 0 18px var(--red); filter:none; }
      6%, 10% { opacity:.2; text-shadow:none; filter:blur(.2px) contrast(1.1); }
      40% { opacity:.85; text-shadow:0 0 6px var(--green), 0 0 10px var(--red); }
      60% { opacity:.6; text-shadow:none; }
      80% { opacity:1; text-shadow:0 0 12px var(--green), 0 0 16px var(--red); }
    }
    .enter-msg.logged-out{ animation: hardFlicker 1.35s linear infinite; }
    @keyframes smoothGlow {
      0%   { opacity:.85; text-shadow:0 0 6px var(--green); }
      50%  { opacity:1;   text-shadow:0 0 14px var(--green), 0 0 22px var(--red); }
      100% { opacity:.9;  text-shadow:0 0 8px var(--green); }
    }
    .enter-msg.logged-in{ animation: smoothGlow 2.6s ease-in-out infinite; }

    .cta-row{ display:flex; gap:24px; flex-wrap:wrap; justify-content:center; margin-top:7vh; }

    .btn{
      appearance:none; border:none; cursor:pointer; padding:16px 28px;
      font-size:clamp(18px,4.5vw,26px); font-weight:800; border-radius:18px;
      transition: color .22s linear, border-color .22s linear, box-shadow .25s ease,
                 background-color .22s ease, transform .08s ease;
    }
    .btn:active{ transform:translateY(1px) scale(.99); }
    .btn.filled{ color:#001400; background:var(--green);
      box-shadow:0 0 24px rgba(57,255,20,.55), 0 0 80px rgba(57,255,20,.35) inset; }
    .btn:active{
      background:var(--red)!important; color:#fff!important; border-color:var(--red)!important;
      box-shadow:0 0 28px rgba(255,0,51,.8), 0 0 90px rgba(255,0,51,.5) inset; text-shadow:0 0 6px var(--red);
    }
    .btn.ghost{ background:transparent; color:var(--green); border:2px solid var(--green); box-shadow:0 0 24px rgba(57,255,20,.45); }
    .btn.ghost-red{ background:transparent; color:var(--red); border:2px solid var(--red); box-shadow:0 0 24px rgba(255,0,51,.45); }
    .btn.locked{
      background:var(--red)!important; color:#fff!important; border:2px solid var(--red)!important;
      box-shadow:0 0 28px rgba(255,0,51,.8), 0 0 90px rgba(255,0,51,.5) inset; cursor:not-allowed;
    }

    .top-login{ position:fixed; top:28px; right:18px; z-index:3; }

    .top-profile{ position:fixed; top:28px; left:18px; z-index:3; display:none; }
    .profile-chip{
      display:inline-flex; align-items:center; gap:10px; text-decoration:none;
      padding:10px 14px; border-radius:999px; border:2px solid var(--green);
      color:var(--green); background:transparent; font-weight:700; font-size:14px;
      box-shadow:0 0 18px rgba(57,255,20,.35);
    }
    .profile-chip:hover{ transform:translateY(-1px); }
    .profile-ico{
      width:22px; height:22px; border-radius:50%;
      border:2px solid var(--green);
      box-shadow:0 0 8px rgba(57,255,20,.55) inset;
      display:inline-block; position:relative;
      background:
        radial-gradient(10px 10px at 50% 40%, rgba(57,255,20,.6), transparent 60%),
        #000;
    }

    .version{ position:fixed; bottom:20px; left:0; right:0; text-align:center; color:var(--muted); font-size:14px; opacity:.9; z-index:3; }

    /* === Fullscreen: small floating button bottom-right, safe-area aware === */
    .btn.fs-fab{
      position:fixed;
      right:calc(env(safe-area-inset-right,0px) + 14px);
      bottom:calc(env(safe-area-inset-bottom,0px) + 14px);
      z-index:5;
      padding:8px 10px;          /* much smaller */
      font-size:14px;
      line-height:1;
      border-radius:999px;
      width:auto;
      min-width:auto;
    }
    /* Optional visual nudge while pressed */
    .btn.fs-fab:active{ transform:translateY(1px) scale(.98); }

    /* CSS fallback when OS fullscreen is unavailable */
    body.fs .wrap{ max-width:100%; padding:0 8px 0 8px; }
    body.fs .hero{ min-height:100vh; padding-top:12vh; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <div class="top-profile">
      <a id="profileLink" class="profile-chip" href="./profile.html" aria-label="Profile">
        <span class="profile-ico"></span>
        <span>Profile</span>
      </a>
    </div>

    <div class="top-login">
      <a id="authBtn" class="btn ghost" href="./login.html" role="button">Login</a>
    </div>

    <main class="hero">
      <h1 class="title">R‚í∂GE&nbsp;&nbsp;SPACE</h1>

      <p class="tagline">
        Drop your art. Unleash the battle. None of that censored bullshit.
        Talk about DIY shit in your cities. Fuck Instagram.
      </p>

      <div class="cta-row">
        <button id="enterBtn" class="btn filled enter-pulse">üêá&nbsp;Enter</button>
        <button id="signupBtn" class="btn filled signup-flicker">Sign Up</button>
      </div>

      <div id="enterMsg" class="enter-msg"></div>
    </main>

    <div class="version">v0.0.1 ‚Ä¢ prototype</div>
  </div>

  <!-- NEW: tiny fullscreen toggle (bottom-right) -->
  <button id="fsAppBtn" class="btn ghost fs-fab" aria-label="Toggle full screen" title="Toggle full screen">‚õ∂</button>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const authBtn    = document.getElementById("authBtn");
    const enterBtn   = document.getElementById("enterBtn");
    const signupBtn  = document.getElementById("signupBtn");
    const enterMsg   = document.getElementById("enterMsg");
    const topProfile = document.querySelector(".top-profile");
    const fsBtn      = document.getElementById("fsAppBtn");

    let isLoggedIn = false;
    let sb = null;

    const safe = (fn) => (...args) => { try{ return fn(...args); } catch(e){ console.error(e); } };

    /* === GLOBAL FULLSCREEN HELPERS (reuse on any page) === */
    async function enterTrueFullscreen(){
      const el = document.documentElement;
      if (el.requestFullscreen) { try{ await el.requestFullscreen(); }catch(_){} }
    }
    async function exitTrueFullscreen(){
      if (document.fullscreenElement && document.exitFullscreen) {
        try{ await document.exitFullscreen(); }catch(_) {}
      }
    }
    async function toggleFullscreen(){
      const goingOn = !document.body.classList.contains('fs');
      if (goingOn){
        document.body.classList.add('fs');     // CSS fallback
        fsBtn.textContent = '‚úï';
        await enterTrueFullscreen();           // ignores if blocked
        window.scrollTo(0,0);
      }else{
        document.body.classList.remove('fs');
        fsBtn.textContent = '‚õ∂';
        await exitTrueFullscreen();
      }
    }
    fsBtn.addEventListener('click', toggleFullscreen);
    // If user exits OS fullscreen via ESC/back, keep CSS state in sync
    document.addEventListener('fullscreenchange', ()=>{
      if (!document.fullscreenElement){
        document.body.classList.remove('fs');
        fsBtn.textContent = '‚õ∂';
      }
    });

    /* === Your existing auth/UI wiring === */
    function usernameFromSession(session){
      const u = session?.user;
      return u?.user_metadata?.username || u?.email || "user";
    }
    function setEnterMsgState(state){
      enterMsg.classList.remove('logged-in','logged-out');
      if(state === 'logged-in') enterMsg.classList.add('logged-in');
      if(state === 'logged-out') enterMsg.classList.add('logged-out');
    }
    function renderLoggedOut(){
      if (!authBtn) return;
      authBtn.textContent = "Login";
      authBtn.className = "btn ghost";
      authBtn.setAttribute("href","./login.html");
      authBtn.onclick = null;
      if (signupBtn) signupBtn.style.display = "";
      if (enterMsg) { enterMsg.textContent = ""; setEnterMsgState('logged-out'); }
      if (topProfile) topProfile.style.display = "none";
      isLoggedIn = false;
    }
    function renderLoggedIn(session){
      if (!authBtn) return;
      authBtn.textContent = "Logout";
      authBtn.className = "btn ghost-red";
      authBtn.setAttribute("href","#");
      authBtn.onclick = safe(async (e)=>{
        e.preventDefault();
        if(!sb) return;
        const { error } = await sb.auth.signOut();
        if (error) console.error(error);
      });
      if (signupBtn) signupBtn.style.display = "none";
      const name = usernameFromSession(session);
      if (enterMsg){ enterMsg.textContent = `Welcome, ${name}`; setEnterMsgState('logged-in'); }
      if (topProfile) topProfile.style.display = "block";
      isLoggedIn = true;
    }

    // Buttons ALWAYS wired, even if auth fails
    if (enterBtn) enterBtn.addEventListener("click", (e)=>{
      if (!isLoggedIn){
        e.preventDefault();
        enterBtn.classList.add("locked");
        enterBtn.setAttribute("aria-disabled","true");
        if (enterMsg){ enterMsg.textContent = 'login to follow the white rabbit...'; setEnterMsgState('logged-out'); }
        return;
      }
      location.href="./menu.html";
    });
    if (signupBtn) signupBtn.addEventListener("click", ()=> location.href="./signup.html"));

    // Init Supabase defensively
    try{
      sb = supabase.createClient(
        "https://tuqvpcevrhciursxrgav.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1cXZwY2V2cmhjaXVyc3hyZ2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1MDA0NDQsImV4cCI6MjA3MjA3NjQ0NH0.JbIWJmioBNB_hN9nrLXX83u4OazV49UokvTjNB6xa_Y"
      );
    }catch(e){
      console.error("Supabase init failed:", e);
      renderLoggedOut(); // graceful fallback
      return;
    }

    // Detect session (with guards)
    safe(async ()=>{
      const { data: sessionRes, error } = await sb.auth.getSession();
      if (error) { console.error(error); renderLoggedOut(); return; }
      const session = sessionRes?.session || null;
      if (session) renderLoggedIn(session); else renderLoggedOut();

      sb.auth.onAuthStateChange((_e, newSession)=>{
        if (newSession) renderLoggedIn(newSession); else renderLoggedOut();
      });
    })();
  });
  </script>
</body>
</html>