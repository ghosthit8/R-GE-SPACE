<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rage Space ‚Äî Home</title>
  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --green:#39ff14; --red:#ff0033; --bg:#000; --ink:#e5ffe5; --muted:#8aff8a;
      --title-scale-y:1.28; --title-stroke:.8px; --title-letterspace:.28rem;
      --mask-url: url('./mask.png'); /* update if different path */
    }
    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      overflow-x:hidden;
      background:
        repeating-linear-gradient(
          to bottom,
          #000 0px,
          #000 2px,
          rgba(255,255,255,0.03) 3px
        );
      color:var(--green);
      font-family:ui-sans-serif,system-ui,Arial,Helvetica,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      position:relative;
    }

    .wrap{ max-width:980px; margin:0 auto; padding:0 16px; position:relative; z-index:2; }
    .hero{ min-height:100dvh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding-top:16vh; }

    .title{
      margin:0 auto 30px; font-weight:600; font-size:clamp(44px,12.5vw,150px);
      letter-spacing:var(--title-letterspace); text-transform:uppercase; line-height:.9;
      transform:scaleY(var(--title-scale-y)); transform-origin:center; color:var(--green);
      -webkit-text-stroke:var(--title-stroke) var(--green);
      text-shadow:0 0 24px var(--red), 0 0 6px rgba(57,255,20,.85);
      text-align:center; white-space:nowrap; user-select:none;
      animation:titleGlow 3.75s ease-in-out infinite alternate;
    }
    @keyframes titleGlow{
      0%{ text-shadow:0 0 18px rgba(255,0,51,.5), 0 0 5px rgba(57,255,20,.75); }
      100%{ text-shadow:0 0 28px rgba(255,0,51,.75), 0 0 10px rgba(57,255,20,1); }
    }

    .tagline{
      color:var(--green); font-size:clamp(16px,2.8vw,24px); line-height:1.55; text-align:center;
      max-width:780px; margin:20px auto 0; text-shadow:0 0 10px rgba(57,255,20,.45), 0 0 6px rgba(255,0,51,.6);
    }

    .enter-msg{
      margin: 100px auto 0; font-size: 16px; color: var(--ink); text-align: center;
      opacity: .95; min-height: 1.6em;
    }
    @keyframes hardFlicker {
      0%, 5%, 7%, 9%, 11%, 100% { opacity:1; text-shadow:0 0 10px var(--green), 0 0 18px var(--red); filter:none; }
      6%, 10% { opacity:.2; text-shadow:none; filter:blur(.2px) contrast(1.1); }
      40% { opacity:.85; text-shadow:0 0 6px var(--green), 0 0 10px var(--red); }
      60% { opacity:.6; text-shadow:none; }
      80% { opacity:1; text-shadow:0 0 12px var(--green), 0 0 16px var(--red); }
    }
    .enter-msg.logged-out{ animation: hardFlicker 1.35s linear infinite; }
    @keyframes smoothGlow {
      0%   { opacity:.85; text-shadow:0 0 6px var(--green); }
      50%  { opacity:1;   text-shadow:0 0 14px var(--green), 0 0 22px var(--red); }
      100% { opacity:.9;  text-shadow:0 0 8px var(--green); }
    }
    .enter-msg.logged-in{ animation: smoothGlow 2.6s ease-in-out infinite; }

    .cta-row{ display:flex; gap:24px; flex-wrap:wrap; justify-content:center; margin-top:7vh; }

    .btn{
      appearance:none; border:none; cursor:pointer; padding:16px 28px;
      font-size:clamp(18px,4.5vw,26px); font-weight:800; border-radius:18px;
      transition: color .22s linear, border-color .22s linear, box-shadow .25s ease,
                 background-color .22s ease, transform .08s ease;
    }
    .btn:active{ transform:translateY(1px) scale(.99); }
    .btn.filled{ color:#001400; background:var(--green);
      box-shadow:0 0 24px rgba(57,255,20,.55), 0 0 80px rgba(57,255,20,.35) inset; }
    .btn:active{
      background:var(--red)!important; color:#fff!important; border-color:var(--red)!important;
      box-shadow:0 0 28px rgba(255,0,51,.8), 0 0 90px rgba(255,0,51,.5) inset; text-shadow:0 0 6px var(--red);
    }
    .btn.ghost{ background:transparent; color:var(--green); border:2px solid var(--green); box-shadow:0 0 24px rgba(57,255,20,.45); }
    .btn.ghost-red{ background:transparent; color:var(--red); border:2px solid var(--red); box-shadow:0 0 24px rgba(255,0,51,.45); }
    .btn.locked{
      background:var(--red)!important; color:#fff!important; border:2px solid var(--red)!important;
      box-shadow:0 0 28px rgba(255,0,51,.8), 0 0 90px rgba(255,0,51,.5) inset; cursor:not-allowed;
    }

    .top-login{ position:fixed; top:28px; right:18px; z-index:3; }

    .top-profile{ position:fixed; top:28px; left:18px; z-index:3; display:none; }
    .profile-chip{
      display:inline-flex; align-items:center; gap:10px; text-decoration:none;
      padding:10px 14px; border-radius:999px; border:2px solid var(--green);
      color:var(--green); background:transparent; font-weight:700; font-size:14px;
      box-shadow:0 0 18px rgba(57,255,20,.35);
    }
    .profile-ico{
      width:22px; height:22px; border-radius:50%;
      border:2px solid var(--green);
      box-shadow:0 0 8px rgba(57,255,20,.55) inset;
      display:inline-block; position:relative;
      background:
        radial-gradient(10px 10px at 50% 40%, rgba(57,255,20,.6), transparent 60%),
        #000;
    }

    .version{ position:fixed; bottom:20px; left:0; right:0; text-align:center; color:var(--muted); font-size:14px; opacity:.9; z-index:3; }
  </style>

  <!-- ‚ñ∑ Corner masks -->
  <style>
    .corner-mask{
      position:fixed; bottom:10px;
      width:min(28vw,220px); aspect-ratio:3/4;
      pointer-events:none; z-index:1; mix-blend-mode:screen;
    }
    .corner-mask.left{ left:10px; }
    .corner-mask.right{ right:10px; transform:scaleX(-1); }

    .corner-mask::before,
    .corner-mask::after,
    .corner-mask > .layer{
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(80% 80% at 50% 55%, rgba(57,255,20,.28), rgba(57,255,20,0) 70%),
        var(--mask-url) center / contain no-repeat;
      filter:
        hue-rotate(130deg) saturate(6) brightness(1.25)
        drop-shadow(0 0 12px rgba(57,255,20,.9))
        drop-shadow(0 0 26px rgba(57,255,20,.45));
    }

    .corner-mask::before{
      opacity:.6; mix-blend-mode:screen;
      animation: flicker 1.8s steps(20,end) infinite, jitter 5.2s steps(12,end) infinite;
    }
    .corner-mask::after{
      opacity:.35; mix-blend-mode:screen;
      filter:
        hue-rotate(130deg) saturate(6) brightness(1.15)
        drop-shadow(0 0 10px rgba(255,0,51,.5))
        drop-shadow(0 0 20px rgba(255,0,51,.35));
      animation: flicker 2.6s steps(22,end) infinite reverse, jitter 4.6s steps(10,end) infinite reverse;
    }
    .corner-mask > .layer{
      opacity:.95;
      animation: floaty 6s ease-in-out infinite;
    }
    .corner-mask .scan{
      position:absolute; inset:-2px; content:""; pointer-events:none;
      background:repeating-linear-gradient(
        to bottom,
        rgba(57,255,20,.15) 0 2px,
        rgba(57,255,20,0) 2px 4px
      );
      animation: scan 3.6s linear infinite;
    }

    @keyframes flicker{
      0%,3%,5%,8%,92%,100%{ opacity:.95 }
      4%,6%{ opacity:.25 }
      40%{ opacity:.7 } 60%{ opacity:.55 } 82%{ opacity:1 }
    }
    @keyframes jitter{
      0%{ transform:translate(0,0) }
      20%{ transform:translate(-.6px,.6px) }
      40%{ transform:translate(-.9px,-.4px) }
      60%{ transform:translate(-.3px,.8px) }
      80%{ transform:translate(-.7px,.3px) }
      100%{ transform:translate(0,0) }
    }
    @keyframes floaty{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    @keyframes scan{
      0%{ clip-path: inset(0 0 92% 0); opacity:.32 }
      50%{ clip-path: inset(92% 0 0 0); opacity:.14 }
      100%{ clip-path: inset(0 0 92% 0); opacity:.32 }
    }

    @media (max-width:600px){
      .corner-mask{ width:min(36vw,180px); bottom:6px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <div class="top-profile">
      <a id="profileLink" class="profile-chip" href="./profile.html" aria-label="Profile">
        <span class="profile-ico"></span>
        <span>Profile</span>
      </a>
    </div>

    <div class="top-login">
      <a id="authBtn" class="btn ghost" href="./login.html" role="button">Login</a>
    </div>

    <main class="hero">
      <h1 class="title">R‚í∂GE&nbsp;&nbsp;SPACE</h1>
      <p class="tagline">
        Drop your art. Unleash the battle. None of that censored bullshit.
        Talk about DIY shit in your cities. Fuck Instagram.
      </p>
      <div class="cta-row">
        <button id="enterBtn" class="btn filled enter-pulse">üêá&nbsp;Enter</button>
        <button id="signupBtn" class="btn filled signup-flicker">Sign Up</button>
      </div>
      <div id="enterMsg" class="enter-msg"></div>
    </main>
    <div class="version">v0.0.1 ‚Ä¢ prototype</div>
  </div>

  <!-- ‚ñº bottom masks -->
  <div class="corner-mask left"><i class="scan"></i><i class="layer"></i></div>
  <div class="corner-mask right"><i class="scan"></i><i class="layer"></i></div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const authBtn    = document.getElementById("authBtn");
    const enterBtn   = document.getElementById("enterBtn");
    const signupBtn  = document.getElementById("signupBtn");
    const enterMsg   = document.getElementById("enterMsg");
    const topProfile = document.querySelector(".top-profile");

    let isLoggedIn = false;
    let sb = null;

    const safe = (fn) => (...args) => { try{ return fn(...args); } catch(e){ console.error(e); } };

    function usernameFromSession(session){
      const u = session?.user;
      return u?.user_metadata?.username || u?.email || "user";
    }
    function setEnterMsgState(state){
      enterMsg.classList.remove('logged-in','logged-out');
      if(state === 'logged-in') enterMsg.classList.add('logged-in');
      if(state === 'logged-out') enterMsg.classList.add('logged-out');
    }
    function renderLoggedOut(){
      if (!authBtn) return;
      authBtn.textContent = "Login";
      authBtn.className = "btn ghost";
      authBtn.setAttribute("href","./login.html");
      authBtn.onclick = null;
      if (signupBtn) signupBtn.style.display = "";
      if (enterMsg) { enterMsg.textContent = ""; setEnterMsgState('logged-out'); }
      if (topProfile) topProfile.style.display = "none";
      isLoggedIn = false;
    }
    function renderLoggedIn(session){
      if (!authBtn) return;
      authBtn.textContent = "Logout";
      authBtn.className = "btn ghost-red";
      authBtn.setAttribute("href","#");
      authBtn.onclick = safe(async (e)=>{
        e.preventDefault();
        if(!sb) return;
        const { error } = await sb.auth.signOut();
        if (error) console.error(error);
      });
      if (signupBtn) signupBtn.style.display = "none";
      const name = usernameFromSession(session);
      if (enterMsg){ enterMsg.textContent = `Welcome, ${name}`; setEnterMsgState('logged-in'); }
      if (topProfile) topProfile.style.display = "block";
      isLoggedIn = true;
    }

    if (enterBtn) enterBtn.addEventListener("click", (e)=>{
      if (!isLoggedIn){
        e.preventDefault();
        enterBtn.classList.add("locked");
        enterBtn.setAttribute("aria-disabled","true");
        if (enterMsg){ enterMsg.textContent = 'login to follow the white rabbit...'; setEnterMsgState('logged-out'); }
        return;
      }
      location.href="./menu.html";
    });
    if (signupBtn) signupBtn.addEventListener("click", ()=> location.href="./signup.html");

    try{
      sb = supabase.createClient(
        "https://tuqvpcevrhciursxrgav.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR1cXZwY2V2cmhjaXVyc3hyZ2F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY1MDA0NDQsImV4cCI6MjA3MjA3NjQ0NH0.JbIWJmioBNB_hN9nrLXX83u4OazV49UokvTjNB6xa_Y"
      );
    }catch(e){
      console.error("Supabase init failed:", e);
      renderLoggedOut();
      return;
    }

    (async ()=>{
      try{
        const { data: sessionRes, error } = await sb.auth.getSession();
        if (error) { console.error(error); renderLoggedOut(); return; }
        const session = sessionRes?.session || null;
        if (session) renderLoggedIn(session); else renderLoggedOut();

        sb.auth.onAuthStateChange((_e, newSession)=>{
          if (newSession) renderLoggedIn(newSession); else renderLoggedOut();
        });
      }catch(err){ console.error(err); renderLoggedOut(); }
    })();
  });
  </script>
</body>
</html>