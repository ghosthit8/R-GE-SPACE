<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Rage Space ‚Äî City Proto</title>

  <!-- Rage City styles -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <!-- note: now goes back UP one level -->
  <a id="btn-menu" class="home-btn" href="../menu.html">‚Üê Menu</a>

  <button id="btn-fullscreen" class="fullscreen-btn">‚õ∂ Fullscreen</button>

  <div id="game-container">
    <div id="game-fallback">Loading Rage City‚Ä¶</div>

    <!-- üî• UPDATED ART OVERLAY -->
    <div id="art-overlay">
      <div id="art-overlay-msg">
        <div id="art-overlay-title"></div>
        <div id="art-overlay-description"></div>
      </div>
      <img
        id="art-overlay-img"
        src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=2000&q=80"
        alt="Gallery art"
      />
    </div>
  </div>

  <div class="controls-overlay">
    <div class="controls-inner">
      <div class="dpad">
        <button class="empty" disabled></button>
        <button id="btn-up">‚ñ≤</button>
        <button class="empty" disabled></button>

        <button id="btn-left">‚óÄ</button>
        <button class="empty" disabled></button>
        <button id="btn-right">‚ñ∂</button>

        <button class="empty" disabled></button>
        <button id="btn-down">‚ñº</button>
        <button class="empty" disabled></button>
      </div>

      <!-- ABXY (Xbox-style diamond) -->
      <div class="abxy">
        <button id="btn-y" class="abxy-btn btn-y">‚óè</button>
        <button id="btn-x" class="abxy-btn btn-x">‚óè</button>
        <button id="btn-b" class="abxy-btn btn-b">‚óè</button>
        <button id="btn-a" class="abxy-btn btn-a">‚óè</button>
      </div>
    </div>
  </div>

  <!-- üîß Hidden file input for per-painting uploads -->
  <input
    type="file"
    id="paintingUpload"
    accept="image/*,video/*"
    style="display:none"
  />

  <!-- Phaser -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>

  <!-- Supabase JS (global client for Rage City gallery) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // üîë Supabase project config for Rage City
    const SUPABASE_URL = "https://tuqvpcevrhciursxrgav.supabase.co";
    const SUPABASE_ANON_KEY = "PASTE_YOUR_ANON_KEY_HERE";

    window.supabase = supabase.createClient(
      SUPABASE_URL,
      SUPABASE_ANON_KEY
    );
  </script>

  <!-- üì± Fullscreen persistence logic (UNCHANGED) -->
  <script>
    (function () {
      let wantsFullscreen = false;
      let pickerOpening = false;
      let suppressClearOnce = false;

      function isFullscreen() {
        return !!(document.fullscreenElement || document.webkitFullscreenElement);
      }

      function requestAppFullscreen() {
        const el = document.documentElement;
        if (isFullscreen()) return;
        if (el.requestFullscreen) el.requestFullscreen().catch(() => {});
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      }

      function exitAppFullscreen() {
        if (document.exitFullscreen) document.exitFullscreen().catch(() => {});
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      }

      function requestSoon() {
        setTimeout(requestAppFullscreen, 60);
        setTimeout(requestAppFullscreen, 250);
        setTimeout(requestAppFullscreen, 650);
      }

      window.ensureAppFullscreen = function () {
        if (wantsFullscreen) requestSoon();
      };

      function markPickerOpening() {
        wantsFullscreen = true;
        pickerOpening = true;
        suppressClearOnce = true;
      }

      function maybeRestore() {
        if (!pickerOpening) return;
        pickerOpening = false;
        wantsFullscreen = true;
        requestSoon();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const fsBtn = document.getElementById("btn-fullscreen");
        const uploadInput = document.getElementById("paintingUpload");
        const btnA = document.getElementById("btn-a");

        if (fsBtn) {
          fsBtn.addEventListener("pointerdown", (e) => {
            e.preventDefault();
            if (isFullscreen()) {
              wantsFullscreen = false;
              exitAppFullscreen();
            } else {
              wantsFullscreen = true;
              requestSoon();
            }
          });
        }

        if (btnA) {
          btnA.addEventListener("pointerdown", markPickerOpening);
        }

        if (uploadInput) {
          uploadInput.addEventListener("click", markPickerOpening);
          uploadInput.addEventListener("change", maybeRestore);
        }

        window.addEventListener("focus", () => {
          if (pickerOpening) maybeRestore();
          else if (wantsFullscreen) requestSoon();
        });

        document.addEventListener("fullscreenchange", () => {
          if (!document.fullscreenElement && !suppressClearOnce) {
            wantsFullscreen = false;
          }
          suppressClearOnce = false;
        });
      });
    })();
  </script>

  <!-- Rage City scripts -->
  <script src="./js/input.js"></script>
  <script src="./js/overlay.js"></script>
  <script src="./js/ragecity-gallery-helpers.js"></script>
  <script src="./js/cityScene.js"></script>
  <script src="./js/main.js"></script>
</body>
</html>